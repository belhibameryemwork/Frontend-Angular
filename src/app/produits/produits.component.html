<div class="container mt-5">
  <h1 class="mb-4">Filtrer les produits</h1>

  <div class="row">
    <div class="col-md-6 form-group">
      <label for="filtreCategorie" class="form-label">Filtrer par Catégorie:</label>
      <select id="filtreCategorie" name="filtreCategorie" [(ngModel)]="filtreCategorie" class="form-select" (ngModelChange)="appliquerFiltres()">
        <option value="">Toutes les catégories</option>
        <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.id }} - {{ cat.libelle }}</option>
      </select>
    </div>

    <div class="col-md-6 form-group">
      <label for="filtrePrix" class="form-label">Filtrer par Prix :</label>
      <div class="input-group">
        <span class="input-group-text">€</span>
        <input type="number" id="filtrePrix" name="filtrePrix" [(ngModel)]="filtrePrix" class="form-control" (ngModelChange)="appliquerFiltres()">
      </div>
    </div>
  </div>
</div>
<div *ngIf="produitEdite" class="container mt-5">
  <h1>Editer le produit</h1>
  <form>
    <div class="form-group row">
      <label for="editCode" class="col-md-2 col-form-label">Code:</label>
      <div class="col-md-10">
        <input id="editCode" name="editCode" type="text" [(ngModel)]="produitEdite.code" class="form-control" required />
      </div>
    </div>
    <div class="form-group row">
      <label for="editDesignation" class="col-md-2 col-form-label">Désignation:</label>
      <div class="col-md-10">
        <input id="editDesignation" name="editDesignation" type="text" [(ngModel)]="produitEdite.designation" class="form-control" required />
      </div>
    </div>
    <div class="form-group row">
      <label for="editPrix" class="col-md-2 col-form-label">Prix:</label>
      <div class="col-md-10">
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text">€</span>
          </div>
          <input id="editPrix" name="editPrix" type="number" [(ngModel)]="produitEdite.prix" class="form-control" required />
        </div>
      </div>
    </div>
    <div class="form-group row">
      <label for="categorie" class="col-md-2 col-form-label">Catégorie:</label>
      <div class="col-md-10">
        <select id="categorie" name="categorie" [(ngModel)]="produitEdite.categorie" class="form-control" required>
          <option *ngFor="let cat of categories" [ngValue]="cat">{{cat.id}} - {{ cat.libelle }}</option>
        </select>
      </div>
    </div>
    <div class="form-group row">
      <div class="col-md-12" align="center">
        <button type="submit" (click)="mettreAJourProduit()" class="btn btn-primary">Modifier</button>
      </div>
    </div>
  </form>
</div>

<div class="container mt-5">
  <h1>Liste des produits</h1>
  <table class="table table-striped">
    <thead>
      <tr>
        <th> Id </th>
        <th> Code </th>
        <th> Designation </th>
        <th> Prix </th>
        <th> Catégorie </th>
        <th colspan="2"> Actions </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of filtrerProduits(produits, filtreCategorie, filtrePrix)">
        <td> {{p.id}} </td>
        <td> {{p.code}} </td>
        <td> {{p.designation}} </td>
        <td> {{p.prix}} </td>
        <td> {{p.categorie ? p.categorie.libelle : 'N/A'}} </td>
        <td>
          <button (click)="editerProduit(p)" class="btn btn-dark">
            <i class="bi bi-pencil"></i> Editer
          </button>
        </td>
        <td>
          <button (click)="supprimerProduit(p)" class="btn btn-danger">
            <i class="bi bi-trash"></i> Supprimer
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
